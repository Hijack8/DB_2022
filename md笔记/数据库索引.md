# 数据库索引

## 面试

* 数据库有几千万的数据，查询又很慢我们怎么办？

加索引，索引是需要创建的，默认的数据库是没有索引的。要对某一列加索引，可以大大提高这一列的查询速度。

* 那索引有哪些数据类型？

Hash B+  在设计索引的时候，发现索引是可以选择的。

* 索引是怎么样的一种结构？



* 哪些字段又适合索引呢？
* B+的优点？

对于Hash索引来说，第一会有Hash冲突的出现。

此外，如果想查找一条数据，我们使用name = '鸡蛋'，可以直接使用Hash索引，但是如果我们使用name > '鸡蛋'，就不行了。

哈希表的特点就是**可以快速的精确查询，但是不支持范围查询**。

* Hash表在哪些场景比较适合？

等值查询的时候，就只有KV的情况，例如Redis、Memecached等这些NoSQL的中间件。

* 除了无序Hash，有没有有序Hash表

**有序数组**，可以支持等值查询和范围查询。有序数组的缺点是仅仅适合**静态数据**，你如果想要新增删除修改数据就会改变他的结构，成本比较高。可以用来做静态存储引擎，保存静态数据，例如历史记录的账单。

* 聚合索引和非聚合索引的区别？
* 为什么说索引会降低插入、删除、修改等维护任务的速度？
* 平衡二叉树做索引？

二叉树是有序的，支持**范围查询**，但是时间复杂度是O(log(n))，为了维持这个时间复杂度，更新的时间复杂度也是O(log(n))，那就要保持这棵树是**完全平衡二叉树**了。

索引不只是在内存里面存储的，还是要落盘持久化的，如果数据多了，树就会很高，查询的成本也会随之提高。

* B树做索引？

同样的元素，B树的表示要比完全平衡二叉树要矮，原因在于B树种的一个节点可以存储多个元素。

* 为什么用B+树做索引？

最开始的Hash不支持范围查询，二叉树树很高，只有B树很B+有的一比。

B树一个节点可以存储多个元素，相对于完全平衡二叉树整体的树高降低了，磁盘的IO效率提高了。

而B+树是B树的升级版，知识把非叶子节点冗余一下，这样可以**提高范围查找的效率**，因为会**有指针指向下一节点**。

* B+树的一个节点到底多大合适？

一个节点为一页或页的倍数最为合适。

因为如果一个节点大小小于一页，那么读取这个节点的时候也会读出一页，造成资源的浪费，如果一个节点的大小大于一页，比如1.2页那么读取这个节点的时候会读出两页，也会造成资源的浪费。

* 数据库中页的概念？

MySQL的基本存储结构是**页**。所有数据页组成一个**双向链表**，数据页中的记录可以组成一个**单向链表**，每个数据页会为它存储的记录生成一个页目录，在通过主键查找某条记录的时候，可以在页目录中使用二分快速定位到对应的**槽**，然后再遍历该槽对应分组中的记录即可快速找到指定的记录。以其他列作（非主键）为搜索条件：只能从最小记录开始依次遍历单链表中的每条记录。

>Mysql的默认存储引擎是InnoDB，InnoDB是以页为基本存储结构的。

* 最左匹配原则？

索引可以简单如一个列，也可以复杂如过个列，即**联合索引**。

如果是联合索引，那么Key也是由多个列组成，同时，索引只能用于查找Key是否存在，遇到范围查询就不能进一步匹配了。

列的排列顺序决定了可命中索引的列数。

